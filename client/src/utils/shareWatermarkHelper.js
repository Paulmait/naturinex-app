// ðŸ·ï¸ Share Watermark Helper
// Automatically appends disclaimers and branding based on user tier

/**
 * Generate watermarked content for sharing
 * @param {string} suggestions - AI suggestions text
 * @param {string} medicationName - Name of medication scanned
 * @param {string} userTier - User's subscription tier
 * @param {object} user - User object (for premium branding)
 * @returns {string} - Watermarked content ready for sharing
 */
export const generateShareContent = (suggestions, medicationName, userTier, user = null) => {
  const timestamp = new Date().toLocaleDateString();
  const baseContent = `MEDICATION ANALYSIS: ${medicationName}\nGenerated: ${timestamp}\n\n${suggestions}`;
  
  switch (userTier) {
    case 'free':
      return `${baseContent}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ·ï¸ GENERATED BY Naturinex FREE\n\nâš ï¸ IMPORTANT DISCLAIMER:\nâ€¢ This is AI-generated educational content\nâ€¢ NOT professional medical advice\nâ€¢ Always consult healthcare providers\nâ€¢ For emergencies, contact medical services\n\nðŸ’Ž Upgrade to Premium for:\nâœ“ Advanced AI analysis\nâœ“ Permanent storage\nâœ“ Ad-free sharing\nâœ“ Priority support\n\nðŸŒ Get Naturinex: https://Naturinex.app`;
      
    case 'basic':
      return `${baseContent}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ“± GENERATED BY Naturinex BASIC\n\nâš ï¸ MEDICAL DISCLAIMER:\nâ€¢ AI-generated educational information only\nâ€¢ Not a substitute for professional medical advice\nâ€¢ Consult healthcare providers before making changes\nâ€¢ Emergency situations require immediate medical attention\n\nðŸŒ Powered by Naturinex - Your AI Health Assistant`;
      
    case 'premium':
      return `${baseContent}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ’Ž Naturinex PREMIUM ANALYSIS\n${user?.displayName ? `Generated for: ${user.displayName}\n` : ''}âš ï¸ MEDICAL DISCLAIMER:\nâ€¢ Advanced AI analysis for educational purposes\nâ€¢ Professional medical consultation recommended\nâ€¢ Not intended to replace healthcare provider advice\nâ€¢ Contact emergency services for urgent health matters\n\nðŸŒ Naturinex Premium - Advanced AI Health Analysis`;
      
    case 'professional':
      return `${baseContent}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ† Naturinex PROFESSIONAL REPORT\n${user?.displayName ? `Healthcare Provider: ${user.displayName}\n` : ''}Analysis Date: ${timestamp}\nReport ID: MS-${Date.now()}\n\nâš ï¸ PROFESSIONAL DISCLAIMER:\nâ€¢ AI-assisted analysis for healthcare professionals\nâ€¢ Clinical judgment and patient evaluation required\nâ€¢ Not a replacement for medical examination\nâ€¢ For educational and reference purposes only\n\nðŸ“§ Questions? Contact: support@Naturinex.app\nðŸŒ Naturinex Professional - Healthcare AI Tools`;
      
    default:
      return baseContent;
  }
};

/**
 * Generate downloadable report with enhanced formatting
 * @param {string} suggestions - AI suggestions
 * @param {string} medicationName - Medication name
 * @param {string} userTier - User tier
 * @param {object} user - User object
 * @returns {object} - Download data with filename and content
 */
export const generateDownloadReport = (suggestions, medicationName, userTier, user = null) => {
  const timestamp = new Date().toISOString().slice(0, 19).replace(/[:.]/g, '-');
  const sanitizedMedName = medicationName.replace(/[^a-zA-Z0-9]/g, '_');
  
  const content = generateShareContent(suggestions, medicationName, userTier, user);
  
  const filename = `Naturinex_${sanitizedMedName}_${timestamp}.txt`;
  
  return {
    filename,
    content,
    mimeType: 'text/plain'
  };
};

/**
 * Generate email content with proper formatting
 * @param {string} suggestions - AI suggestions
 * @param {string} medicationName - Medication name  
 * @param {string} userTier - User tier
 * @param {object} user - User object
 * @returns {object} - Email data with subject and body
 */
export const generateEmailContent = (suggestions, medicationName, userTier, user = null) => {
  const tierName = {
    free: 'Free',
    basic: 'Basic', 
    premium: 'Premium',
    professional: 'Professional'
  }[userTier] || 'Basic';
  
  const subject = `Naturinex ${tierName} Analysis: ${medicationName}`;
  const body = generateShareContent(suggestions, medicationName, userTier, user);
  
  return {
    subject: encodeURIComponent(subject),
    body: encodeURIComponent(body)
  };
};

/**
 * Generate branding watermark based on tier
 * @param {string} userTier - User subscription tier
 * @returns {string} - Watermark text
 */
export const getBrandingWatermark = (userTier) => {
  const watermarks = {
    free: 'ðŸ·ï¸ Generated by Naturinex Free - Upgrade for more features!',
    basic: 'ðŸ“± Powered by Naturinex Basic',
    premium: 'ðŸ’Ž Naturinex Premium Analysis',
    professional: 'ðŸ† Naturinex Professional Report'
  };
  
  return watermarks[userTier] || watermarks.basic;
};

/**
 * Check if user can share without watermark
 * @param {string} userTier - User tier
 * @returns {boolean} - True if no watermark needed
 */
export const canShareWithoutWatermark = (userTier) => {
  return ['basic', 'premium', 'professional'].includes(userTier);
};